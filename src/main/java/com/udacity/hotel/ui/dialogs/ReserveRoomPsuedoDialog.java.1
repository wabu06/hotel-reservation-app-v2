package com.udacity.hotel.ui.dialogs;



import javafx.stage.*;
import javafx.scene.Scene;

import javafx.scene.control.*;
import javafx.scene.layout.HBox;
import javafx.scene.layout.VBox;

import javafx.geometry.Pos;

import javafx.event.ActionEvent;

//import javafx.scene.paint.Color;

import com.udacity.hotel.resources.*;
import static com.udacity.hotel.resources.UtilityResource.*;

import java.util.Optional;
import java.util.Date;

import java.time.LocalDate;
import java.time.ZoneId;



public class ReserveRoomPsuedoDialog
{
	private HotelResource HR;
	
	private Stage dialogStage;
	private Scene dialogScene;
	
	private TextField etf;
	private PasswordField ptf;
	
	private DatePicker checkInDatePicker;
  private DatePicker checkOutDatePicker;
  
  private Date cid, cod;
  
  private ToggleGroup rtg; // room type toggle group
  
  private String email, pin, roomType;
  
  private boolean okButtonClicked = false;
	
	public ReserveRoomPsuedoDialog(Stage owner)
	{
		HR = HotelResource.getInstance();
		
		Label el = new Label("Email:");
		etf = new TextField();
		HBox ebox = new HBox(el, etf);
		
		Label pl = new Label("Pin:");
		ptf = new PasswordField();
		HBox pbox = new HBox(pl, ptf);
		
		rtg = new ToggleGroup();
		
		Label rtl = new Label("Room Type:");
		
		RadioButton srb = new RadioButton("Single");
    srb.setToggleGroup(rtg);
    srb.setUserData("Single");
    
    RadioButton drb = new RadioButton("Double");
    drb.setToggleGroup(rtg);
    drb.setUserData("Double");
    
    VBox rtBox = new VBox(rtl, srb, drb);
    rtBox.setSpacing(5.0d);
    
    Label cidl = new Label("Check In Date:");
    checkInDatePicker = new DatePicker();
    
    Label codl = new Label("Check Out Date:");
    checkOutDatePicker = new DatePicker();
    
    VBox dBox = new VBox(cidl, checkInDatePicker, codl, checkOutDatePicker);
    dBox.setSpacing(5.0d);
    
    Button okBttn = new Button("OK");
		//okBttn.setOnAction(e -> dialogStage.hide());
		okBttn.setOnAction(this::getAndParseDialogData);

		Button cancelBttn = new Button("CANCEL");
		cancelBttn.setOnAction( e ->	{
																		okButtonClicked = false;
																		dialogStage.hide();
																	});
																	
		HBox bttnBox = new HBox(okBttn, cancelBttn);
		bttnBox.setSpacing(5.0d);
		
		VBox dialogBox = new VBox(ebox, pbox, new Separator (), rtBox, new Separator(), dBox, new Separator(), bttnBox);
		dialogBox.setSpacing(5.0d);
		dialogBox.setAlignment(Pos.TOP_CENTER);
		
		dialogScene = new Scene(dialogBox);
		
		dialogStage = new Stage(StageStyle.UTILITY);
		
		dialogStage.initOwner(owner);
		dialogStage.initModality(Modality.APPLICATION_MODAL);
		
		dialogStage.setWidth(250);
		dialogStage.setHeight(350);
		
		dialogStage.setScene(dialogScene);
	}
	
	private void getAndParseDialogData(ActionEvent e)
	{
		email = etf.getText();
		pin = ptf.getText();
		
		if( email.isEmpty() || pin.isEmpty() )
		{
			var alert = new Alert(Alert.AlertType.ERROR, "Must Enter Email & Pin!!");
			alert.initStyle(StageStyle.UNDECORATED);
			alert.showAndWait();
			return;
		}
		
		if( !isEmailValid(email) )
		{
			var alert = new Alert(Alert.AlertType.ERROR, "Email Address Must Be Entered As name@domain.com!!");
			alert.initStyle(StageStyle.UNDECORATED);
			alert.showAndWait();
			return;
		}
		
		Optional<String> errMsg = validatePin(pin);
		
		if( errMsg.isPresent() )
		{
			var alert = new Alert(Alert.AlertType.ERROR, errMsg.get());
			alert.initStyle(StageStyle.UNDECORATED);
			alert.showAndWait();
			return;
		}
		
		if( !HR.isAuthentic(email, pin) )
		{
			var alert = new Alert(Alert.AlertType.ERROR, "Incorrect Email or Pin!!");
			alert.initStyle(StageStyle.UNDECORATED);
			alert.showAndWait();
			return;
		}
		
		if(rtg.getSelectedToggle() == null)
		{
			var alert = new Alert(Alert.AlertType.ERROR, "Please Select A Room Type!!");
			alert.initStyle(StageStyle.UNDECORATED);
			alert.showAndWait();
			return;
		}
		else
			roomType = rtg.getSelectedToggle().getUserData().toString();
			
		LocalDate cild = checkInDatePicker.getValue();
		
		if(cild == null)
		{
			var alert = new Alert(Alert.AlertType.ERROR, "Please Select A Check In Date!!");
			alert.initStyle(StageStyle.UNDECORATED);
			alert.showAndWait();
			return;		
		}
		else
			cid = Date.from( cild.atTime(11, 0).atZone( ZoneId.systemDefault() ).toInstant() );
			
		LocalDate cold = checkOutDatePicker.getValue();
		
		if(cold == null)
		{
			var alert = new Alert(Alert.AlertType.ERROR, "Please Select A Check Out Date!!");
			alert.initStyle(StageStyle.UNDECORATED);
			alert.showAndWait();
			return;		
		}
		else
			cod = Date.from( cold.atTime(15, 0).atZone( ZoneId.systemDefault() ).toInstant() );
			
		okButtonClicked = true;
		
		dialogStage.hide();
	}
	
	public String getEmail() {
		return email;
	}
	
	public String getPin() {
		return pin;
	}
	
	public String getRoomType() {
		return roomType;
	}
	
	public Date getCheckInDate() {
	 return cid;
	}
	
	public Date getCheckOutDate() {
		return cod;
	}
	
	public void show() {
		dialogStage.showAndWait();
	}
	
	public boolean okButtonWasClicked() {
		return okButtonClicked;
	}
}


